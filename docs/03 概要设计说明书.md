# 概要设计说明书

《宠物托运智能服务系统》概要设计说明书

2025年3月31日

## 1 引言

### 1.1 编写目的

本概要设计说明书旨在明确**宠物托运智能服务系统**的总体架构设计、功能模块划分及技术实现方案，为后续详细设计、开发、测试和部署提供指导依据。

### 1.2 项目概况

本系统面向**宠物主人、托运公司及平台管理方**，提供智能化的宠物托运服务管理功能，核心功能包括：用户管理、订单管理、托运追踪、社会交流及智能客服模块，通过数字化手段提升托运效率与安全性。

### 1.3 术语定义

表1  术语表

| 术语/缩写 | 定义 |
| :---: | --- |
| GPS | 全球定位系统（Global Positioning System），用于实时跟踪宠物托运状态。 |
| RAG | 检索增强生成（Retrieval-Augmented Generation），用于智能客服解答托运问题。 |
| API | 应用程序接口（Application Programming Interface），用于系统功能的外部调用。 |

### 1.4 参考资料

《系统实施计划》

《需求规格说明书-V1.0》

## 2 系统概述

### 2.1 运行环境

#### 2.1.1 硬件环境

（1）服务器配置

+ CPU：8核及以上
+ 内存：16GB及以上
+ 硬盘：500GB SSD及以上
+ 带宽：10Mbps及以上

（2）客户端设备

+ 移动端：Android 8.0+/iOS 12+
+ PC端：Windows 10+/macOS 10.15+
+ 平板端：iPadOS 14+/Android 10+

#### 2.1.2 软件环境

（1）后端

+ 开发语言：Java 17
+ 核心框架：Spring Boot 3.0 + MyBatis Plus
+ 接口协议：RESTful API
+ 安全认证：JWT实现用户身份鉴权
+ 缓存服务：Redis 6.0+ 进行高频数据缓存
+ 容器化部署：Docker + Nginx进行反向代理与负载均衡

（2）前端

+ 核心框架：Vue 3 + Vite
+ UI 组件库：Ant Design Vue统一组件风格
+ 网络请求：Axios封装RESTful接口调用
+ 状态管理：Pinia替代Vuex，实现轻量级状态管理

（3）数据库

+ 主数据库：MySQL 8.0
+ 数据库工具：MyBatis Plus支持动态 SQL
+ 文件存储：阿里云 OSS

（4）部署方案

+ 容器化：Docker打包后端服务与前端静态资源
+ 代理服务器：Nginx配置反向代理、静态资源托管与HTTPS加密

#### 2.1.3 数据结构

核心数据表

+ t_user：用户表（用户ID，用户名，密码，用户身份，用户地址，用户头像，公司ID）
+ t_pet：宠物表（宠物ID，用户ID，宠物名称，宠物品种，宠物体重，宠物健康状态）
+ t_picture：图片表（图片ID，图片用途）
+ t_order：订单表（订单ID，宠物ID，图片ID，订单状态，托运状态，运输状态）
+ t_chat：对话表（对话ID，用户ID，对话内容）
+ t_post：推文表（推文ID，用户ID，推文内容，推文评论）
+ t_company：公司表（公司ID，公司介绍，公司地址）
+ t_comment：评论表（评价ID，公司ID，用户ID，评论内容）

![](https://cdn.nlark.com/yuque/0/2025/png/40615927/1745302435016-8d6bbef8-2b79-421b-982b-2655ea62ce00.png)

### 2.2 需求概述

![image-20250422142409190](C:\Users\Shurang\AppData\Roaming\Typora\typora-user-images\image-20250422142409190.png)

图：系统用例图

## 3 原则与规范

### 3.1 设计原则

（1）可靠性

+ 采用主备数据库+负载均衡架构，确保核心业务（下单、支付、追踪）可用性≥99.9%。
+ 关键服务（如智能AI、地图定位）实现故障自动切换，保障系统稳定性。

（2）安全性

+ 用户数据传输加密（SSL/TLS），存储加密（AES-256），敏感信息双重加密。
+ 基于角色的访问控制（RBAC），限制未授权操作，防范SQL注入、XSS等攻击。

（3）可扩展性

+ 模块化架构设计，支持动态扩展功能（如新增AI模型、第三方服务对接）。
+ 数据库采用分库分表策略，支持未来100万+订单数据存储。

（4）用户体验优化

+ 界面响应时间≤2 秒（如订单创建、AI问答），地图定位实时刷新。
+ 移动端优先适配，支持Android/iOS设备的交互优化。

（5）合规性

+ 遵循《动物防疫法》《道路运输管理条例》，确保托运流程合法合规。
+ 用户数据处理符合GDPR和国内隐私保护法规。

### 3.2 设计规范

#### 3.2.1 命名规范

+ 模块命名：采用英文单词组合，如UserManagement、OrderTracking。
+ 数据库表名：下划线分隔小写字母，如user_info、pet_order。
+ 字段命名：驼峰式命名，如userId、createTime。
+ 接口命名：RESTful 风格，如GET/api/orders/{id}。

#### 3.2.2 界面规范

+ 布局统一：PC端采用左侧导航栏+顶部工具栏，移动端采用底部标签栏。
+ 交互反馈：操作成功/失败提示统一使用Toast或模态框，避免阻塞式弹窗。
+ 响应式设计：支持平板、手机等多设备自适应，分辨率适配1080P及以上。

#### 3.2.3 代码规范

（1）后端（Java）

+ 遵循Spring Boot编码规范，类名首字母大写，方法名小写驼峰。
+ 避免复杂逻辑嵌套，单个方法代码量≤200行。
+ 使用Lombok简化代码（如@Data、@Slf4j）。

（2）前端（Vue.js）

+ 组件命名PascalCase，如PetInfo.vue。
+ 样式采用SCSS预处理器，统一主题色。
+ 路由配置按需加载，减少首屏加载时间。

#### 3.2.4 数据库规范

+ 索引优化：为高频查询字段（如orderStatus、userId）添加索引。
+ 事务控制：订单创建、支付等操作使用分布式事务。
+ 分库策略：按业务垂直分库（用户库、订单库、日志库）。

#### 3.2.5 日志规范

+ 使用ELK Stack集中管理日志，记录关键操作（如支付、订单修改）。
+ 日志级别分级：ERROR记录异常，INFO记录业务流程，DEBUG用于开发调试。
+ 日志保留期≥6个月，重要日志长期归档。

#### 3.2.6 AI服务规范

+ LLM模型推理响应时间≤2秒，支持异步处理高并发请求。
+ RAG知识库每日更新，确保宠物托运政策、疾病处理等信息时效性。
+ 图像识别模型准确率≥95%，定期通过测试集验证。

## 4 总体设计

### 4.1 系统划分及功能描述

![](https://cdn.nlark.com/yuque/0/2025/png/40615927/1745302435240-f7e3aab7-c5bb-4c67-9164-be8d99a618ce.png)

### 4.2系统架构模型和实现样例

#### 4.2.1 系统架构模型

采用**分层架构**，基于SpringBoot+Spring MVC实现前后端分离设计：

前端采用Vue.js3+Vite，后端Spring Boot3.x + Spring MVC，数据库采用MySQL

![](https://cdn.nlark.com/yuque/0/2025/png/40615927/1745302435448-172919dc-3b0f-45f1-ac98-a4d47204c036.png)

+ Controller 接收请求，返回 JSON 响应
+ 使用 @RestController 注解定义 RESTful API 接口
+ Service 实现核心业务逻辑
+ 调用基础设施层集成第三方服务（如高德地图 API、支付宝接口）
+ 使用MyBatis操作数据库

#### 4.2.2 实现样例

以**订单创建流程**为例，详细说明各层交互逻辑：

![](https://cdn.nlark.com/yuque/0/2025/png/40615927/1745302435602-e2432b87-94b3-4b9e-91ec-136510749602.png)

### 4.3 公用接口程序设计说明

#### 4.3.1 全局变量

全局变量在系统中应严格限制使用，仅在必要时通过单例模式或依赖注入管理共享资源，避免数据竞争与副作用。

1. 全局配置参数

**定义**：系统级配置（如第三方API密钥、超时时间）。

**实现：**

<font style="color:#B3AE60;">@Configuration  
</font><font style="color:#B3AE60;">@ConfigurationProperties</font><font style="color:#BCBEC4;">(prefix = </font><font style="color:#6AAB73;">"system.config"</font><font style="color:#BCBEC4;">)</font><font style="color:#CF8E6D;">public class </font><font style="color:#BCBEC4;">GlobalConfig {  
</font><font style="color:#BCBEC4;">    </font><font style="color:#CF8E6D;">private </font><font style="color:#BCBEC4;">String </font><font style="color:#C77DBB;">amapApiKey</font><font style="color:#BCBEC4;">;  </font><font style="color:#7A7E85;">// 高德地图API密钥    
</font><font style="color:#7A7E85;">    </font><font style="color:#CF8E6D;">private int </font><font style="color:#C77DBB;">requestTimeout</font><font style="color:#BCBEC4;">;  </font><font style="color:#7A7E85;">// HTTP请求超时时间（毫秒）    
</font><font style="color:#7A7E85;">    // Getter/Setter  </font><font style="color:#BCBEC4;">}  </font>

**访问方式：**通过Spring @Autowired 注入到需使用的类中。

1. 共享服务实例

**定义：**需要全局访问的服务。

**实现方式：**

<font style="color:#B3AE60;">@Component</font><font style="color:#CF8E6D;">public class </font><font style="color:#BCBEC4;">RedisManager {  
</font><font style="color:#BCBEC4;">    </font><font style="color:#B3AE60;">@Autowired  
</font><font style="color:#B3AE60;">    </font><font style="color:#CF8E6D;">private </font><font style="color:#BCBEC4;">RedisTemplate<String, String> </font><font style="color:#C77DBB;">redisTemplate</font><font style="color:#BCBEC4;">;  

</font><font style="color:#BCBEC4;">    </font><font style="color:#7A7E85;">// 全局缓存操作接口    
</font><font style="color:#7A7E85;">    </font><font style="color:#CF8E6D;">public void </font><font style="color:#56A8F5;">setCache</font><font style="color:#BCBEC4;">(String key, String value) {  
</font><font style="color:#BCBEC4;">        </font><font style="color:#C77DBB;">redisTemplate</font><font style="color:#BCBEC4;">.opsForValue().set(key, value);  
</font><font style="color:#BCBEC4;">    }  
</font><font style="color:#BCBEC4;">}  </font>

#### 4.3.2 其他 

1.公共工具类：

**功能：**封装通用操作逻辑，避免代码冗余。

**示例：**

<font style="color:#CF8E6D;">public class </font><font style="color:#BCBEC4;">DateUtils {  
</font><font style="color:#BCBEC4;">    </font><font style="color:#CF8E6D;">private static final </font><font style="color:#BCBEC4;">SimpleDateFormat </font>_<font style="color:#C77DBB;">sdf </font>_<font style="color:#BCBEC4;">= </font><font style="color:#CF8E6D;">new </font><font style="color:#BCBEC4;">SimpleDateFormat(</font><font style="color:#6AAB73;">"yyyy-MM-dd HH:mm:ss"</font><font style="color:#BCBEC4;">);  

</font><font style="color:#BCBEC4;">    </font><font style="color:#7A7E85;">// 日期格式化    
</font><font style="color:#7A7E85;">    </font><font style="color:#CF8E6D;">public static </font><font style="color:#BCBEC4;">String </font><font style="color:#56A8F5;">formatDate</font><font style="color:#BCBEC4;">(Date date) {  
</font><font style="color:#BCBEC4;">        </font><font style="color:#CF8E6D;">return </font>_<font style="color:#C77DBB;">sdf</font>_<font style="color:#BCBEC4;">.format(date);  
</font><font style="color:#BCBEC4;">    }  
</font><font style="color:#BCBEC4;">}  
</font><font style="color:#CF8E6D;">public class </font><font style="color:#BCBEC4;">EncryptionUtils {  
</font><font style="color:#BCBEC4;">    </font><font style="color:#7A7E85;">// AES加密    
</font><font style="color:#7A7E85;">    </font><font style="color:#CF8E6D;">public static </font><font style="color:#BCBEC4;">String </font><font style="color:#56A8F5;">encrypt</font><font style="color:#BCBEC4;">(String data, String key) { ... }  
</font><font style="color:#BCBEC4;">} </font>

2.全局异常处理：

**功能：**统一捕获并处理系统异常，返回标准化错误响应。

**实现方式：**

<font style="color:#B3AE60;">@ControllerAdvice</font><font style="color:#CF8E6D;">public class </font><font style="color:#BCBEC4;">GlobalExceptionHandler {  
</font><font style="color:#BCBEC4;">    </font><font style="color:#B3AE60;">@ExceptionHandler</font><font style="color:#BCBEC4;">(Exception.</font><font style="color:#CF8E6D;">class</font><font style="color:#BCBEC4;">)  
</font><font style="color:#BCBEC4;">    </font><font style="color:#CF8E6D;">public </font><font style="color:#BCBEC4;">ResponseEntity<ErrorResponse> </font><font style="color:#56A8F5;">handleException</font><font style="color:#BCBEC4;">(Exception ex) {  
</font><font style="color:#BCBEC4;">        ErrorResponse response = </font><font style="color:#CF8E6D;">new </font><font style="color:#BCBEC4;">ErrorResponse(</font><font style="color:#2AACB8;">500</font><font style="color:#BCBEC4;">, </font><font style="color:#6AAB73;">"系统内部错误"</font><font style="color:#BCBEC4;">, ex.getMessage());  
</font><font style="color:#BCBEC4;">        </font><font style="color:#CF8E6D;">return </font><font style="color:#BCBEC4;">ResponseEntity.status(</font><font style="color:#2AACB8;">500</font><font style="color:#BCBEC4;">).body(response);  
</font><font style="color:#BCBEC4;">    }  

</font><font style="color:#BCBEC4;">    </font><font style="color:#7A7E85;">// 自定义业务异常处理    
</font><font style="color:#7A7E85;">    </font><font style="color:#B3AE60;">@ExceptionHandler</font><font style="color:#BCBEC4;">(BusinessException.</font><font style="color:#CF8E6D;">class</font><font style="color:#BCBEC4;">)  
</font><font style="color:#BCBEC4;">    </font><font style="color:#CF8E6D;">public </font><font style="color:#BCBEC4;">ResponseEntity<ErrorResponse> </font><font style="color:#56A8F5;">handleBusinessException</font><font style="color:#BCBEC4;">(BusinessException ex) {  
</font><font style="color:#BCBEC4;">        ErrorResponse response = </font><font style="color:#CF8E6D;">new </font><font style="color:#BCBEC4;">ErrorResponse(ex.getCode(), ex.getMessage(), </font><font style="color:#CF8E6D;">null</font><font style="color:#BCBEC4;">);  
</font><font style="color:#BCBEC4;">        </font><font style="color:#CF8E6D;">return </font><font style="color:#BCBEC4;">ResponseEntity.status(</font><font style="color:#2AACB8;">400</font><font style="color:#BCBEC4;">).body(response);  
</font><font style="color:#BCBEC4;">    }  
</font><font style="color:#BCBEC4;">} </font>

1. 日志记录接口

**功能：**统一日志格式、级别及存储策略。

**实现方式：**

<font style="color:#B3AE60;">@Slf4j  
</font><font style="color:#B3AE60;">@Component</font><font style="color:#CF8E6D;">public class </font><font style="color:#BCBEC4;">SystemLogger {  
</font><font style="color:#BCBEC4;">    </font><font style="color:#7A7E85;">// 记录操作日志（存入数据库或文件）    
</font><font style="color:#7A7E85;">    </font><font style="color:#CF8E6D;">public void </font><font style="color:#56A8F5;">logOperation</font><font style="color:#BCBEC4;">(String userId, String action) {  
</font><font style="color:#BCBEC4;">        log.info(</font><font style="color:#6AAB73;">"用户 {} 执行操作：{}"</font><font style="color:#BCBEC4;">, userId, action);  
</font><font style="color:#BCBEC4;">        </font><font style="color:#7A7E85;">// 可扩展为异步写入数据库    
</font><font style="color:#7A7E85;">    </font><font style="color:#BCBEC4;">}  

</font><font style="color:#BCBEC4;">    </font><font style="color:#7A7E85;">// 记录错误日志（带堆栈信息）    
</font><font style="color:#7A7E85;">    </font><font style="color:#CF8E6D;">public void </font><font style="color:#56A8F5;">logError</font><font style="color:#BCBEC4;">(String module, Exception e) {  
</font><font style="color:#BCBEC4;">        log.error(</font><font style="color:#6AAB73;">"模块 {} 发生异常：{}"</font><font style="color:#BCBEC4;">, module, e.getMessage(), e);  
</font><font style="color:#BCBEC4;">    }  
</font><font style="color:#BCBEC4;">}  </font>

1. 权限验证模块

**功能：**统一管理用户鉴权与角色权限。

**实现方式：**

<font style="color:#B3AE60;">@Component</font><font style="color:#CF8E6D;">public class </font><font style="color:#BCBEC4;">AuthValidator {  
</font><font style="color:#BCBEC4;">    </font><font style="color:#B3AE60;">@Autowired  
</font><font style="color:#B3AE60;">    </font><font style="color:#CF8E6D;">private </font><font style="color:#BCBEC4;">JwtTokenProvider </font><font style="color:#C77DBB;">jwtTokenProvider</font><font style="color:#BCBEC4;">;  

</font><font style="color:#BCBEC4;">    </font><font style="color:#7A7E85;">// 验证Token并获取用户角色    
</font><font style="color:#7A7E85;">    </font><font style="color:#CF8E6D;">public </font><font style="color:#BCBEC4;">UserRole </font><font style="color:#56A8F5;">validateToken</font><font style="color:#BCBEC4;">(String token) {  
</font><font style="color:#BCBEC4;">        </font><font style="color:#CF8E6D;">if </font><font style="color:#BCBEC4;">(!</font><font style="color:#C77DBB;">jwtTokenProvider</font><font style="color:#BCBEC4;">.validateToken(token)) {  
</font><font style="color:#BCBEC4;">            </font><font style="color:#CF8E6D;">throw new </font><font style="color:#BCBEC4;">BusinessException(</font><font style="color:#6AAB73;">"无效的Token"</font><font style="color:#BCBEC4;">);  
</font><font style="color:#BCBEC4;">        }  
</font><font style="color:#BCBEC4;">        </font><font style="color:#CF8E6D;">return </font><font style="color:#C77DBB;">jwtTokenProvider</font><font style="color:#BCBEC4;">.getRoleFromToken(token);  
</font><font style="color:#BCBEC4;">    }  

</font><font style="color:#BCBEC4;">    </font><font style="color:#7A7E85;">// 校验用户操作权限    
</font><font style="color:#7A7E85;">    </font><font style="color:#CF8E6D;">public void </font><font style="color:#56A8F5;">checkPermission</font><font style="color:#BCBEC4;">(UserRole role, String requiredPermission) {  
</font><font style="color:#BCBEC4;">        </font><font style="color:#CF8E6D;">if </font><font style="color:#BCBEC4;">(!role.getPermissions().contains(requiredPermission)) {  
</font><font style="color:#BCBEC4;">            </font><font style="color:#CF8E6D;">throw new </font><font style="color:#BCBEC4;">BusinessException(</font><font style="color:#6AAB73;">"权限不足"</font><font style="color:#BCBEC4;">);  
</font><font style="color:#BCBEC4;">        }  
</font><font style="color:#BCBEC4;">    }  
</font><font style="color:#BCBEC4;">}  </font>

1. 第三方服务封装接口

**功能：**统一封装高德地图、支付宝等第三方服务调用逻辑。

**示例：**

<font style="color:#B3AE60;">@Component</font><font style="color:#CF8E6D;">public class </font><font style="color:#BCBEC4;">MapServiceClient {  
</font><font style="color:#BCBEC4;">    </font><font style="color:#B3AE60;">@Autowired  
</font><font style="color:#B3AE60;">    </font><font style="color:#CF8E6D;">private </font><font style="color:#BCBEC4;">RestTemplate </font><font style="color:#C77DBB;">restTemplate</font><font style="color:#BCBEC4;">;  
</font><font style="color:#BCBEC4;">    </font><font style="color:#B3AE60;">@Value</font><font style="color:#BCBEC4;">(</font><font style="color:#6AAB73;">"${amap.api.url}"</font><font style="color:#BCBEC4;">)  
</font><font style="color:#BCBEC4;">    </font><font style="color:#CF8E6D;">private </font><font style="color:#BCBEC4;">String </font><font style="color:#C77DBB;">apiUrl</font><font style="color:#BCBEC4;">;  

</font><font style="color:#BCBEC4;">    </font><font style="color:#7A7E85;">// 调用高德地图路径规划    
</font><font style="color:#7A7E85;">    </font><font style="color:#CF8E6D;">public </font><font style="color:#BCBEC4;">Route </font><font style="color:#56A8F5;">calculateRoute</font><font style="color:#BCBEC4;">(String start, String end) {  
</font><font style="color:#BCBEC4;">        String url = </font><font style="color:#C77DBB;">apiUrl </font><font style="color:#BCBEC4;">+ </font><font style="color:#6AAB73;">"?origin=" </font><font style="color:#BCBEC4;">+ start + </font><font style="color:#6AAB73;">"&destination=" </font><font style="color:#BCBEC4;">+ end;  
</font><font style="color:#BCBEC4;">        </font><font style="color:#CF8E6D;">return </font><font style="color:#C77DBB;">restTemplate</font><font style="color:#BCBEC4;">.getForObject(url, Route.</font><font style="color:#CF8E6D;">class</font><font style="color:#BCBEC4;">);  
</font><font style="color:#BCBEC4;">    }  
</font><font style="color:#BCBEC4;">}  </font>



